# hw5_2

# 1
## 1.1
前向传播阶段分析：

第一个 microbatch 需要 p × tf 时间完成所有阶段
后续 (m-1) 个 microbatch 每个需要 tf 时间（流水线并行）
前向传播总时间：Tf = p × tf + (m-1) × tf = (p + m - 1) × tf

反向传播阶段分析：

第一个 microbatch 需要 p × tb 时间完成所有阶段
后续 (m-1) 个 microbatch 每个需要 tb 时间（流水线并行）
反向传播总时间：Tb = p × tb + (m-1) × tb = (p + m - 1) × tb

总执行时间表达式：
T_total = (p + m - 1) × tf + (p + m - 1) × tb
T_total = (p + m - 1) × (tf + tb)

## 1.2
48ms

## 1.3
66 / 48 = 1.375

# 2
Tf = (p + m - 1) × (tf + tb) = (4 + 16 - 1) × 6 = 114ms
Bubble Ratio = T_total / T_ideal = 114 / 96 = 1.1875
流水线气泡的本质： 气泡主要来自于流水线启动和结束时的不完全利用

启动阶段：前 (p-1) 个时间步，不是所有 GPU 都在工作
结束阶段：后 (p-1) 个时间步，不是所有 GPU 都在工作


气泡时间是固定的： 无论 microbatch 数量如何变化，气泡时间都是 2×(p-1)×(tf+tb)
气泡时间 = 2 × (4-1) × (2+4) = 2 × 3 × 6 = 36 ms

相对比例减小： 随着 microbatch 数量增加，气泡时间占总时间的比例减小

m = 8 时：气泡时间/总时间 = 36/66 = 54.5%
m = 16 时：气泡时间/总时间 = 36/114 = 31.6%

# 3
更好的设备利用率：
前向和反向传播可以并行执行，而不是串行
减少了流水线气泡，特别是在中间阶段

数值梯度更新：
可以更早地开始梯度计算和参数更新
减少了训练过程中的等待时间
